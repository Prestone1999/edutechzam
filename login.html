<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Login</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
   <link rel="stylesheet" href="css/style.css">
</head>
<body class="auth-page">

<!-- login section -->
<section class="form-container">
   <form id="loginForm" onsubmit="return handleLogin(event)">
      <h3><img src="images/logo2.png" height="100px" width="100px"></h3>
      <h3>Login to your eduTechzam account</h3>
      
      <div class="input-group">
         <input type="email" name="email" placeholder="Enter your email" required maxlength="50" class="box" id="email">
         <i class="fas fa-envelope"></i>
      </div>
      
      <div class="input-group">
         <input type="password" name="password" placeholder="Enter your password" required maxlength="20" class="box" id="password">
         <i class="fas fa-lock"></i>
         <button type="button" class="password-toggle" onclick="togglePassword('password')">
            <i class="fas fa-eye"></i>
         </button>
      </div>
      
      <!-- Password Strength Indicator -->
      <div id="passwordStrength" class="password-strength"></div>
      
      <div class="forgot-password">
         <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
      </div>
      
      <input type="submit" value="Login" name="submit" class="btn">
      <a href="index.html" class="btn option-btn">Back Home</a>
      
      <div class="form-divider">
         <span>or continue with</span>
      </div>
      
      <div class="social-login">
         <a href="#" class="social-btn">
            <i class="fab fa-google"></i> Google
         </a>
         <a href="#" class="social-btn">
            <i class="fab fa-facebook-f"></i> Facebook
         </a>
      </div>
      
      <p>Don't have an account? <a href="register.html">Register now</a></p>
   </form>
</section>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal-overlay">
   <div class="modal-content">
      <div class="modal-header">
         <h3>Reset Password</h3>
         <button class="modal-close-btn" onclick="closeForgotPassword()">&times;</button>
      </div>
      <form id="forgotPasswordForm">
         <p>Enter your email address and we'll send you a link to reset your password.</p>
         <div class="input-group">
            <input type="email" placeholder="Enter your email" required class="box" id="resetEmail">
            <i class="fas fa-envelope"></i>
         </div>
         <input type="submit" value="Send Reset Link" class="btn">
         <button type="button" class="btn option-btn" onclick="closeForgotPassword()">Cancel</button>
      </form>
   </div>
</div>


<!-- Check if user is already logged in -->
<script src="js/script.js"></script>
<script>
// Handle login form submission
function handleLogin(event) {
   event.preventDefault();
   
   const email = document.getElementById('email').value.trim();
   const password = document.getElementById('password').value;
   
   if (!email || !password) {
      alert('Please enter both email and password');
      return false;
   }
   
   // Get users from storage (check both 'users' and 'lms_users' for backward compatibility)
   const users = JSON.parse(localStorage.getItem('users') || localStorage.getItem('lms_users') || '[]');
   
   // Find user with matching email and password
   const user = users.find(u => u.email === email && u.password === password);
   
   if (!user) {
      alert('Invalid email or password');
      return false;
   }
   
   // Store current user in localStorage
   localStorage.setItem('currentUser', JSON.stringify(user));
   
   // Log login activity
   if (typeof logActivity === 'function') {
      logActivity('login', 'Logged In', `User logged into the system as ${user.userType}`, window.location.href);
   }
   
   // Redirect based on user type
   if (user.userType === 'student') {
      window.location.href = 'home.html';
   } else if (user.userType === 'teacher') {
      window.location.href = 'teacher_home.html';
   } else if (user.userType === 'admin') {
      window.location.href = 'admin_dash.html';
   }
   
   return false;
}

document.addEventListener('DOMContentLoaded', function() {
   // Redirect if already logged in
   const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
   if (currentUser) {
      if (currentUser.userType === 'student') {
         window.location.href = 'home.html';
      } else if (currentUser.userType === 'teacher') {
         window.location.href = 'teacher_home.html';
      } else if (currentUser.userType === 'admin') {
         window.location.href = 'admin_dash.html';
      }
   }
   
   // Set up form submission handler
   const loginForm = document.getElementById('loginForm');
   if (loginForm) {
      loginForm.addEventListener('submit', handleLogin);
   }
});
</script>


<!-- Load script.js before our script to ensure logActivity is available -->
<script src="js/script.js"></script>
</body>
</html>
